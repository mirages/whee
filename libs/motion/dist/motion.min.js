/**
 * motion
 * v1.0.0
 * by shuijingleihen
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Motion=e()}(this,function(){"use strict";var e,s,t;(t=e=e||{}).realtime="realtime",t.frame="frame",(t=s=s||{}).x="x",t.y="y",t.xy="xy";function n(){}function a(t){void 0===t&&(t={}),this.trendData=[],this.maxLength=4,this.tmThreshold=50,this.prevData=null,this.renderData=null,this.animateId=0,this.rendering=!1,this.accumulation=6,this.touchstartHandler=n,this.touchmoveHandler=n,this.touchendHandler=n,this.el=t.target?this.getEl(t.target):null,this.mode=t.mode||e.realtime,this.direction=t.direction||s.xy,this.mode===e.frame?this.move=this.moveAnimate:this.move=this.moveRealtime,this.initEvent()}return a.prototype.getEl=function(t){return"string"==typeof t?document.querySelector(t):t},a.prototype.initEvent=function(){var i=this;this.el&&(this.el.addEventListener("touchstart",function(t){i.start(t),i.touchstartHandler(t)},!!a.isSupportPassive&&{passive:!1,capture:!0}),this.el.addEventListener("touchmove",function(e){e.preventDefault(),i.move(e,function(t){i.touchmoveHandler(t,e)})},!!a.isSupportPassive&&{passive:!1,capture:!0}),this.el.addEventListener("touchend",function(e){i.end(e,function(t){i.touchendHandler(t,e)})}))},a.prototype.createData=function(t){var e=Date.now();return{x:t.pageX,y:t.pageY,t:e}},a.prototype.getMoveData=function(t){this.prevData||(this.prevData=t);var e={x:t.x-this.prevData.x,y:t.y-this.prevData.y,t:t.t-this.prevData.t};return this.prevData=t,e},a.prototype.isNeedInertiaScroll=function(){return 1<this.trendData.length},a.prototype.touchstart=function(t){void 0===t&&(t=n),this.touchstartHandler=t},a.prototype.touchmove=function(t){void 0===t&&(t=n),this.touchmoveHandler=t},a.prototype.touchend=function(t){void 0===t&&(t=n),this.touchendHandler=t},a.prototype.start=function(t){t=t.targetTouches[0];this.trendData=[],this.prevData=this.createData(t),this.setTrendData(this.prevData),this.clearInertiaScroll()},a.prototype.move=function(t,e){},a.prototype.moveAnimate=function(t,e){var i=this;void 0===e&&(e=n);t=t.targetTouches[0],t=this.createData(t);this.setTrendData(t),this.renderData=t,this.rendering||(this.rendering=!0,this.animateId=requestAnimationFrame(function(){var t=i.getMoveData(i.renderData),t={x:i.direction!==s.y?t.x:0,y:i.direction!==s.x?t.y:0};e(t),i.rendering=!1}))},a.prototype.moveRealtime=function(t,e){void 0===e&&(e=n);var i=t.targetTouches[0],t=this.createData(i),i=this.getMoveData(t),i={x:this.direction!==s.y?i.x:0,y:this.direction!==s.x?i.y:0};this.setTrendData(t),e(i)},a.prototype.setTrendData=function(t){var e,i,n;this.trendData.length<1?this.trendData.push(t):(n=this.trendData[this.trendData.length-1],e=t.t-n.t,i=t.x-n.x,n=t.y-n.y,e>this.tmThreshold&&Math.sqrt(Math.pow(i,2)+Math.pow(n,2))/e<.3?this.trendData=[]:this.trendData.push(t),this.trendData.length>this.maxLength&&this.trendData.shift())},a.prototype.end=function(t,e){void 0===e&&(e=n);t=t.changedTouches[0],t=this.createData(t);this.setTrendData(t),this.isNeedInertiaScroll()?this.inertiaScroll(e):e({x:0,y:0})},a.prototype.inertiaScroll=function(i){var n=this,t=this.trendData[0],e=this.trendData[this.trendData.length-1],t={x:e.x-t.x,y:e.y-t.y,t:e.t-t.t},a=this.getMoveStep(t.x,t.t),r=this.getMoveStep(t.y,t.t);this.direction===s.x?r=function(){return 0}:this.direction===s.y&&(a=function(){return 0});var o=function(){var t=a(),e=r();0===t&&0===e||(n.animateId=requestAnimationFrame(o)),i({x:t,y:e})};o()},a.prototype.getMoveStep=function(t,e){var n=this,t=t/e,a=t/e/10,r=t,o=-a/15;return function(){var t=o+.04*a,e=r-o*n.accumulation,i=(r+e)/2*n.accumulation;return o=n.isMoveStop(r,e)?r=i=0:(r=e,t),i}},a.prototype.isMoveStop=function(t,e){return t===1/0||t===-1/0||0===t||t/e<0},a.prototype.clearInertiaScroll=function(){cancelAnimationFrame(this.animateId)},a.isSupportPassive=function(){var t=!1;try{document.createElement("div").addEventListener("testPassive",n,{get passive(){return!(t=!0)}})}catch(t){}return t}(),a.Direction=s,a.Mode=e,a});
